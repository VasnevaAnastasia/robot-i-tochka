# UC-08 Оформление заказа

### Предусловия

1. Кассовый день открыт.
2. Пользователь авторизован или не авторизован в системе.
3. В корзине добавлено хотя бы одно блюдо.
4. Пользователь находится в корзине.

### Постусловия

1. Заказ оформлен.

### Основной сценарий

1. Пользователь нажимает кнопку «Оформить заказ».
2. Система отображает экран оформления заказа. Все блюда из корзины отображаются в заказе.
3. Пользователь выбирает способ получения заказа (в зале / навынос/доставка),
4. Пользователь выбирает способ оплаты заказа (банковской картой / наличными при получении),
5. Пользователь выбирает копить баллы программы лояльности (если пользователь авторизован И на его счету есть бонусы).
6. Пользователь указывает свои контактные данные (если пользователь авторизован, данные подтягиваются из его профиля).
7. Если пользователь выбрал способ оплаты «банковской картой», то он нажимает кнопку «Оплатить заказ».
8. Система проверяет наличие заказанных блюд и ингредиентов. Все блюда и ингредиенты доступны.
9. Выполняется сценарий **[UC-09 Оплата заказа картой](uc09.md)**.
10. Система сохраняет данные заказа, формирует номер заказа, присваивает заказу статус «Создан».
11. Система отправляет в сервис управления роботами информацию, что создан новый заказ.
12. Система информирует пользователя об успешной оплате, отображает номер и статус заказа на устройстве пользователя и на табло в зале.

### Альтернативные сценарии

2.а. Система отображает экран оформления заказа. Если пользователь не авторизован, система предлагает подключиться к программе лояльности.

1. Пользователь хочет зарегистрироваться в программу лояльности:
    1. Выполняется сценарий **[UC-01 Регистрация в программе лояльности](uc01.md)**.
    2. Выполняется **основной сценарий**, начиная с шага 2.
2. Пользователь хочет войти в личный кабинет:
    1. Выполняется сценарий **[UC-02 Авторизация в программе лояльности](uc02.md)**.
    2. Выполняется **основной сценарий**, начиная с шага 2.
3. Пользователь не хочет подключиться/войти в программу лояльности:
    1. Выполняется **основной сценарий**, начиная с шага 3.

3.а. Пользователь оформляет доставку. 
Выполняется **сценарий [UC-17 Оформление доставки](uc17.md)**.

4.а. Пользователь выбрал «Наличными при получении».

1. Пользователь нажимает кнопку «Оформить заказ».
2. Выполняется **основной сценарий**, начиная с шага 7.

6.а. Пользователь выбирает списать баллы программы лояльности (если пользователь авторизован И на его счету есть бонусы).

1. Сумма заказа сразу пересчитывается.
2. Выполняется **основной сценарий**, начиная с шага 7.

9.1.а. Система проверяет наличие заказанных блюд и ингредиентов. Одно или несколько блюд или ингредиентов НЕдоступны.

1. Система выводит уведомление, что часть блюд стали недоступны для заказа, и предлагает сделать замену или удалить блюдо из заказа.
2. Пользователь выбирает заменить блюдо.
3. Система отображает меню ресторана. Выполняется **сценарий [UC-04 Добавление блюда в корзину](uc04.md)**.
4. Система заменяет недоступное блюдо выбранным.
5. Выполняется **основной сценарий**, начиная с шага 2.

9.2.а. Пользователь выбирает удалить блюдо.

1. Система удаляет недоступное блюдо из корзины.
2. Выполняется **основной сценарий**, начиная с шага 2.


**Прерывание процесса:**

1. Пользователь покидает экран оформления заказа любым доступным ему способом на любом из шагов.
2. Заказ не создается.
3. Система на любом шаге позволяет завершить процесс.

*Пользователь может вернуться на экран оформления заказа только через повторный запуск основного сценария из корзины.*


